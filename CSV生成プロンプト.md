# R18 PC同人ゲーム記事CSV生成プロンプト

このファイルを添付して、チャットで「年月（YYYY年MM月）」のみを指定することで、AIが記事を生成してCSV出力します。

**重要**: JavaScriptスクリプト（generate-csv.js）は使用せず、VS Code Copilot Agentが直接処理を実行します。

---

## プロンプト本文

{指定年月}に発売されたR18 PC同人ゲームのレビュー記事を、**当月発売タイトルをすべて対象**としてAIで生成し、CSVファイルとして出力してください。

**実行方法**: JavaScriptスクリプトは使わず、以下の手順を直接実行してください。

### 1. ゲーム情報の取得（当月発売タイトルを全件）
Node.jsのコマンドラインで以下を実行してゲーム情報を取得：

```javascript
const dlsite = require('./services/dlsiteService');
const games = await dlsite.fetchGamesByMonth({年}, {月});
console.log(JSON.stringify(games, null, 2));
```

または、ターミナルで以下のNode.jsコマンドを実行：
```bash
node -e "const dlsite = require('./services/dlsiteService'); dlsite.fetchGamesByMonth({年}, {月}).then(games => console.log(JSON.stringify(games, null, 2))).catch(err => { console.error(err); process.exit(1); });"
```

取得したゲーム情報のJSON配列を次のステップで使用します。

**重要（取得結果の別JSON保存）**
- 取得したゲーム情報（全件）を、以下のファイルとして保存してください（create_file ツールで作成）：
  - 出力先: `c:\Users\hider\mytool\csvoutput\fetched_games_{年}-{月}.json`
  - 内容: `fetchGamesByMonth(年, 月)` が返した配列をそのまま JSON で保存

**重要（取得元の固定）**
- ゲーム情報の取得は `services/dlsiteService.js` の `fetchGamesByMonth(年, 月)` を必ず使用してください
- `generateSampleGames` 等のサンプル生成（架空データ）を使って埋めないでください

### 2. AI記事の生成
取得した各ゲームについて、**GitHub Copilot（Claude Sonnet 4.5）を使用**して、以下の形式でレビュー・攻略記事を生成：

**重要**: OpenAI APIは使用せず、GitHub Copilot Chatの機能で記事を生成してください。

**タイトル形式:**
```
【{ジャンル}】{ゲームタイトル} 攻略・レビュー
```

**説明（50-100文字）:**
- ゲームの簡単な紹介
- ジャンルや特徴を明記
- プレイヤーの興味を引く内容

**本文（800-1200文字）:**
以下の構成でMarkdown形式で記述：

```markdown
## ゲーム概要
- 作品の基本情報と世界観
- ゲームシステムの説明
- 特徴的な要素の紹介

## 攻略ポイント
### 序盤の進め方
- 最初にやるべきこと
- 注意すべき点
- 効率的な進行方法

### 中盤以降の攻略
- 効率的な進め方
- おすすめの攻略順
- 重要なポイント

### エンディング到達のコツ
- クリアまでの流れ
- 回収要素について
- 分岐条件の解説

## プレイレビュー
### 良かった点
- システム面での評価
- ストーリーやキャラクター
- グラフィック・演出
- プレイ感や没入感

### 気になった点
- 改善してほしい要素
- プレイ時の注意点
- バランス面の課題

## 総合評価
- 総合的なおすすめ度（7-9点/10点満点）
- どんな人におすすめか
- プレイ時間の目安
- 価格に対するコストパフォーマンス
```

**記事生成の指示:**
各ゲームタイトル、ジャンル、サークル名、価格情報を元に、GitHub Copilot Chat（Claude Sonnet 4.5）で創造的かつ具体的なレビュー・攻略記事を生成してください。テンプレートではなく、ゲームタイトルやジャンルの特性を反映した独自の内容にしてください。

**重要: 価格の取得と表示**
- 基本情報の「価格」は、**必ずDLsiteの作品ページ（基本情報のDLsite URL）**を確認して取得してください
  - DLsiteページ内の「**サークル設定価格**」または「**価格**」の項目に価格が設定されています
- 価格が取得できない/判定できない場合は、**0円で埋めずに `-`（ハイフン）で表示**してください

**重要: 架空タイトルの禁止**
- DLsiteから取得したゲーム情報（JSON配列）に含まれる作品のみを対象にしてください
- **架空のゲームタイトル、架空のRJ番号、架空のサークル名、架空の発売日、架空の画像URLを作成・追加しないでください**
- 取得に失敗して対象作品が確定できない場合は、無理に生成せず「取得に失敗したため中断」として止めてください（代替で架空データに置き換えない）

**重要: 同一段落の反復出力を厳禁**
- 生成する本文内で同一の段落・見出し・フレーズを繰り返して出力しないでください
- 特に「## 追加レビュー」のような汎用的な見出しとその内容を複数回配置することを禁じます
- 各セクション（## ゲーム概要、## 攻略ポイント、## プレイレビュー、## 総合評価など）は1回のみ記述してください
- 文字数を満たすための冗長なパディングや、コピー&ペーストによる同文の繰り返しは行わないでください
- Markdown（.md）ファイルとして保存・配布する場合も同様に、同一段落の反復を行わないよう指示してください
- 各記事は固有の内容で構成し、ゲーム固有の攻略情報や評価ポイントを具体的に記述してください

**ジャンル判定:**
タイトルから以下のいずれかを推測：
- RPG
- アドベンチャー
- シミュレーション
- アクション
- パズル
- その他

**評価:**
- 7〜9の範囲で設定（平均8程度）
- ゲームの内容やジャンルに応じて適切な値を設定

**タグ:**
- **DLsiteで使用されているジャンルタグ**を参考に、ゲームの特徴を表す3-5個のタグをAIで生成
- **必ずDLsite公式のジャンル表記に従うこと**
- タグ例（DLsite準拠）:
  - キャラクター系: 「学生」「メイド」「人妻/主婦」「OL」「巫女」「獣耳/しっぽ」「触手」「モンスター娘」
  - シチュエーション: 「恋愛」「純愛」「ハーレム」「逆ハーレム」「同棲」「寝取り/寝取られ/NTR」「おねショタ」「調教」「洗脳」「精神支配」
  - 場所: 「学園」「屋内」「野外/屋外」「青姦」
  - ジャンル: 「ファンタジー」「SF」「ホラー」「ミステリー」「時代物」
  - システム: 「RPG」「3D作品」「動画」「音声あり」「音楽あり」「体験版あり」
  - 要素: 「日常/生活」「バトル」「コメディ」「ギャグ」「シリアス」「ダンジョン」「管理/経営」「罠」「謎解き」「探索」「癒し」
  - その他: 「フルカラー」「音声あり」「動画あり」「追加コンテンツ」「短編」「続編」
- ゲームタイトル、説明、ジャンルから推測される最適なタグを選定
- タグは半角カンマ区切りで記述（例: 「学生,恋愛,学園,純愛」）

**アフィリエイトリンク:**
- 固定値: `https://www.dlsite.com/maniax/`
- ※後で各ゲーム固有のURLに変更予定

**ステータス:**
- `draft`（下書き状態）

### 3. CSV出力
生成した記事データを使用して、**create_file ツール**でCSVファイルを直接作成してください。

**重要な制約事項:**
- **5件ずつCSV出力すること** - 10件以上を一度に出力するとAIの応答がタイムアウトします
- **出力先フォルダ**: `c:\Users\hider\mytool\csvoutput\`
- **ファイル名形式**: `articles_{年}-{月}_part{番号}.csv`（例: `articles_2025-12_part1.csv`, `articles_2025-12_part2.csv`）
- エンコーディング: UTF-8 BOM付き
- 形式: CSV（カンマ区切り）
- 列構成（日本語ヘッダー）:
  ```
  タイトル,ゲームタイトル,説明,本文,ジャンル,評価,画像URL,ステータス,発売日,タグ,アフィリエイトリンク
  ```

**CSV作成手順:**

- 既に同名の `articles_{年}-{月}_part{番号}.csv` が存在する場合は上書きせず、新しい連番ファイルを作成してください（例: 既に `part1` と `part2` がある場合は `part3` を作成）。シンプルな実装方法: 出力フォルダの該当ファイル名をチェックして、最大の `{番号}` を検出し +1 した番号で新規作成すること。
- CSV内の「説明」「本文」は、既存の `csvoutput/articles_2025-12_part1.csv` のスタイル・詳細度を参照して生成してください。具体的には説明は50〜100文字、本文は800〜1200文字のMarkdown（見出しとセクション構成）で、`articles_2025-12_part1.csv` と同等の文量・表現を目安にします。

- **本文長の明確化:** 本文はMarkdown形式で、見出し・セクション構成を含めて **800〜1,200文字程度** にまとめてください（品質優先）。

**最重要（必読）:** 時間をいくらかけても良いので品質を最優先してください。生成する記事は内容の正確性、文法、Markdown構成（見出し・セクション）、タグの適切性、エスケープ処理（CSV内のダブルクォート等）を厳密にチェック・修正してから出力してください。速度よりも品質（読みやすさ・正確さ・一貫性）を優先し、不安な場合は手動での微調整を行ってください。

1. csvoutputフォルダが存在しない場合は作成
2. 各ゲームのAI生成記事データを配列に格納
3. **5件ずつ**に分割してCSV出力
  - 1-5件目: `articles_{年}-{月}_part1.csv`
  - 6-10件目: `articles_{年}-{月}_part2.csv`
  - 11-15件目: `articles_{年}-{月}_part3.csv` (以降同様)
4. CSVヘッダー行を作成
5. 各記事をCSV行に変換（カンマ区切り、改行・カンマを含む場合はダブルクォートで囲む）
6. create_file ツールで `c:\\Users\\hider\\mytool\\csvoutput\\articles_{年}-{月}_part{番号}.csv` に書き込み

**重要: Markdown記号の処理**
- 本文フィールドはMarkdown形式で記述されています
- Web表示時にHTMLに変換する必要があります
- CSVインポート後、サーバー側（routes/csv.js または表示時）でMarkdownをHTMLに変換してください
- 推奨ライブラリ: `marked` または `markdown-it`
  ```javascript
  const marked = require('marked');
  article.content = marked.parse(article.content);
  ```

### 4. ゲーム情報の永続化（重複回避）
取得したゲーム情報を保存し、次回実行時に**同じゲームを再出力しない**ようにします。

**ゲーム情報管理ファイル:**
- ファイル名: `c:\Users\hider\mytool\csvoutput\processed_games.json`
- 形式: JSON配列
- 保存内容: `[{"id": "RJ01234567", "title": "ゲームタイトル", "processedDate": "2025-12-31"}, ...]`

**処理フロー:**
1. DLsiteからゲーム情報を取得
2. `processed_games.json` を読み込み（存在しない場合は空配列）
3. 既に処理済みのゲームID（RJ番号）をフィルタリングで除外（**再実行時は除外必須**）
4. 新規ゲームのみを対象に、**5件ずつ**記事生成→CSV出力
5. 各CSV出力が完了したら、そのCSVに含めたゲーム情報を `processed_games.json` に追記して保存

**CSV形式の例:**
```csv
タイトル,ゲームタイトル,説明,本文,ジャンル,評価,画像URL,ステータス,発売日,タグ,アフィリエイトリンク
"【RPG】魔王討伐クエスト 攻略・レビュー","魔王討伐クエスト","ダークファンタジーの世界を舞台にした本格RPG。戦略的なバトルと重厚なストーリーが魅力。","## ゲーム概要
本作は...","RPG",8,"https://example.com/image.jpg","draft","2025-12-15","ファンタジー,バトル,RPG,ダンジョン","https://www.dlsite.com/maniax/"
```

**重要な注意点:**
- 本文フィールドには改行が含まれるため、必ずダブルクォートで囲むこと
- ダブルクォート内のダブルクォートは `""` とエスケープすること
- UTF-8 BOM付きで保存すること（Excelで文字化けしないため）
- **末尾に空行を入れないこと（重要）**: CSVの末尾に余分な改行（空行）があると、インポート時に「空レコード」が1件発生し、`タイトル/ゲームタイトル/本文` 必須チェックで「行スキップ」エラーになります。
  - **末尾は改行1回だけ**にする（`CRLF` を1回）
  - 最後の行の後に空行（改行2回以上）を付けない

**任意: 生成CSVの事前検証（推奨）**
- 出力後に、同じパーサ設定で「空レコードが混ざっていないか」を確認できます（PowerShell/Nodeどちらでも可）。

```powershell
node -e "const fs=require('fs'); const csv=require('csv-parser'); const rows=[]; fs.createReadStream('csvoutput/articles_{年}-{月}_part{番号}.csv').pipe(csv({skipEmptyLines:true, mapHeaders:({header})=>header.trim()})).on('data', r=>rows.push(r)).on('end',()=>{ const bad=rows.filter(r=>!(r['タイトル']||r['title'])||!(r['ゲームタイトル']||r['gameTitle'])||!(r['本文']||r['content'])); console.log('rows=',rows.length,'bad=',bad.length); if(bad.length) console.log(bad[0]); });"
```

---

## 使用例

### チャットでの指定方法

このmdファイルを添付して、以下のように指定：

```
2025年12月
```

```
2025年11月
```

```
2024年12月
```

**実行の流れ:**
1. VS Code Copilot Chatがこのプロンプトを読み込み
2. DLsiteから当月発売のゲーム情報を**全件**取得（Node.jsコマンド実行）
3. 取得結果を `csvoutput/fetched_games_{年}-{月}.json` に保存
4. `processed_games.json` から既処理ゲームを読み込み、重複を除外
5. 新規ゲームについてAIが記事を生成
6. **5件ずつ**CSVファイルを `csvoutput/` フォルダに出力
7. 出力したゲームを `processed_games.json` に追記して保存
7. 完了メッセージと次のステップを表示

---

## 注意事項

- **JavaScriptスクリプトは使用しません** - VS Code Copilot Agentが直接処理を実行
- **OpenAI APIは使用しません** - GitHub Copilot（Claude Sonnet 4.5）で記事生成
- DLsiteから実際のゲーム情報を取得します
- 記事内容はAIが生成するため、ゲームごとに独自の内容になります
- 生成されたCSVは `http://localhost:3000/csv` からインポート可能
- API料金は発生しません（GitHub Copilot契約の範囲内）
