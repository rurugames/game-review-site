# 発売日以降（YYYY-MM-DD）でのR18抽出ガイド

このガイドは、月次データ（`fetched_games_YYYY-MM.json` / `articles_YYYY-MM_all.csv`）から、
**「発売日が指定日以降」かつ「R18のみ」** を抽出して、別CSV/JSONとして出力する手順です。

## 目的
- 例: 「2026-01-09以降に発売したR18作品だけ」を一覧化したい
- 例: 既存の月次CSV（`articles_YYYY-MM_all.csv`）に未反映の新作だけを把握したい

## 使い方（2通り）

### A. DLsiteを再取得して更新しつつ抽出（最新化）
DLsiteの新着一覧から **対象月の全件を再取得** し、`csvoutput/fetched_games_YYYY-MM.json` を更新してから抽出します。

```powershell
node scripts\extract_r18_from_date.js 2026-01 2026-01-09
```

- 既存の `csvoutput/fetched_games_YYYY-MM.json` は自動で `_old` にバックアップします
- 取得に時間がかかることがあります（DLsiteページ＋詳細のスクレイピング）

### B. 既存の fetched JSON を使って抽出（ネットワークなし）
すでに `csvoutput/fetched_games_YYYY-MM.json` がある前提で、ローカルだけで抽出します。

```powershell
node scripts\extract_r18_from_date_local.js 2026-01 2026-01-09
```

## 出力物
実行すると、以下の4ファイルを `csvoutput/` に作成します（同名がある場合は `_v2` などで自動採番）。

- `fetched_games_YYYY-MM_r18_from_YYYY-MM-DD.json`
  - 条件に一致した作品のJSON（一覧）
- `extract_YYYY-MM_r18_from_YYYY-MM-DD.csv`
  - 上記のCSV（列: `id,title,releaseDate,circle,price,dlsiteUrl,ageRating,genre`）

- `fetched_games_YYYY-MM_r18_from_YYYY-MM-DD_missing.json`
  - 上記のうち、現在の `csvoutput/articles_YYYY-MM_all.csv` に未反映の作品JSON
- `extract_YYYY-MM_r18_from_YYYY-MM-DD_missing.csv`
  - 上記のCSV（未反映分）

## 補足（「未追加」の定義）
- `articles_YYYY-MM_all.csv` の「アフィリエイトリンク」からRJ番号（`RJ\d{8}`）を抽出し、
  それに含まれないものを「未追加」とみなします。

## 注意
- R18判定は `ageRating` を優先し、`全年齢/一般向け` は除外します。
- `articles_YYYY-MM_all.csv` 側が「R18のみ」でない場合、missing判定はブレるので注意してください（R18のみ運用推奨）。
