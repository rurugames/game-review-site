# 記事自動生成機能

## 概要
2025年12月に発売したR18のPC同人ゲームの攻略・レビュー記事を自動生成する機能を実装しました。

## 機能

### 1. 年月指定でゲーム情報取得
- 管理者が年月を選択
- 指定された期間に発売されたR18 PC同人ゲームのリストを取得
- DLsiteからのデータ取得（現在はサンプルデータ）

### 2. 記事の自動生成
- 選択したゲームの記事を自動生成
- AI（OpenAI GPT-4）による高品質な攻略・レビュー記事
- 下書きとして保存され、管理者が確認・編集可能

### 3. バッチ処理
- 複数のゲームを一度に選択して記事生成
- 効率的な記事作成フロー

## 使い方

### 1. アクセス
管理者でログイン後、ナビゲーションメニューから「記事自動生成」をクリック

### 2. 年月を選択
- 年（2023-2025）を選択
- 月（1-12）を選択
- 「ゲームを取得」ボタンをクリック

### 3. ゲームを選択
- 取得されたゲームリストから記事を生成したいゲームにチェック
- デフォルトで全てのゲームが選択されています

### 4. 記事を生成
- 「選択したゲームの記事を生成」ボタンをクリック
- 生成には数分かかる場合があります
- 完了後、各記事へのリンクが表示されます

### 5. 記事の確認と編集
- 生成された記事は「下書き」状態で保存されます
- 各記事ページで内容を確認し、必要に応じて編集
- 問題なければ「公開」状態に変更

## 技術詳細

### 実装ファイル
- `routes/generator.js` - ルート定義
- `views/generator/index.ejs` - UI
- `services/dlsiteService.js` - DLsite連携
- `services/aiService.js` - AI記事生成

### 依存パッケージ
- `axios` - HTTP通信
- `cheerio` - HTMLパース（将来のスクレイピング用）
- `openai` - OpenAI API

### 環境変数
`.env`ファイルに以下を追加（オプション）:
```
OPENAI_API_KEY=your_openai_api_key_here
```

**注意**: OpenAI APIキーが設定されていない場合、サンプル記事が生成されます。

## DLsite連携について

### 現在の実装
現在はサンプルデータを返す実装になっています。指定年月に応じてランダムなゲームデータを生成します。

### 実際のデータ取得方法

#### オプション1: DLsite Affiliate API
DLsiteのアフィリエイトプログラムに参加し、APIキーを取得する方法です。
- 公式: https://www.dlsite.com/affiliate/
- 制限: APIの利用可能範囲に制限あり

#### オプション2: 手動データ入力
CSVファイルやスプレッドシートからゲーム情報をインポートする機能を追加できます。

#### オプション3: スクレイピング
**注意**: 利用規約を確認し、適切な頻度で実施する必要があります。
- robots.txtの確認
- レート制限の実装
- User-Agentの設定

### 実装を更新する場合
`services/dlsiteService.js`の`fetchFromDLsiteAPI`メソッドを実装してください。

## AI記事生成について

### OpenAI GPT-4使用時
- 高品質な記事生成
- 自然な日本語
- 攻略情報とレビューを含む構造化された内容

### APIキー未設定時
- テンプレートベースの記事生成
- 基本的な構造は維持
- 手動編集を前提とした下書き

### カスタマイズ
`services/aiService.js`の`createPrompt`メソッドでプロンプトをカスタマイズできます。

## セキュリティ

### アクセス制限
- 管理者専用機能（`ensureAdmin`ミドルウェア）
- 一般ユーザーはアクセス不可

### API制限
- OpenAI APIキーは環境変数で管理
- レート制限を考慮した実装

## 今後の拡張案

1. **CSVインポート機能**
   - ゲーム情報をCSVでアップロード
   - 手動でのデータ管理が容易

2. **スケジュール実行**
   - 毎月自動でゲーム情報を取得
   - 定期的な記事生成

3. **記事テンプレートの管理**
   - 複数のテンプレートから選択
   - ジャンル別のテンプレート

4. **画像自動取得**
   - ゲームのスクリーンショットを自動取得
   - サムネイル生成

5. **SEO最適化**
   - メタタグの自動生成
   - キーワード最適化

## トラブルシューティング

### ゲームが取得できない
- 現在はサンプルデータなので、年月に関わらずデータが返されます
- 実際のAPI実装後は、APIキーや接続を確認してください

### 記事生成が失敗する
- OpenAI APIキーが設定されていない場合、サンプル記事が生成されます
- APIキーを設定している場合、クォータや接続を確認してください

### 生成に時間がかかる
- OpenAI APIの応答には数秒〜数十秒かかります
- 複数記事を一度に生成する場合、さらに時間がかかります
- ブラウザのタイムアウトに注意してください
