<div class="csv-container">
  <div class="csv-header">
    <h1>ğŸ“Š CSV ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h1>
    <p>è¨˜äº‹ã‚’CSVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ã¾ãŸã¯CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è¨˜äº‹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™</p>
  </div>

  <div class="csv-sections">
    <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="csv-section">
      <h2>ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h2>
      <p>ç¾åœ¨ã®è¨˜äº‹ã‚’CSVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™</p>
      <button id="exportBtn" class="btn-primary">
        <span class="btn-icon">â¬‡ï¸</span>
        è¨˜äº‹ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
      </button>
    </div>

    <!-- ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="csv-section">
      <h2>ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h2>
      <p>CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è¨˜äº‹ã‚’ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™</p>
      
      <form id="importForm" enctype="multipart/form-data">
        <div class="file-input-wrapper">
          <input type="file" id="csvFile" name="csvFile" accept=".csv" required>
          <label for="csvFile" class="file-label">
            <span class="file-icon">ğŸ“</span>
            <span id="fileName">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</span>
          </label>
        </div>
        <button type="submit" class="btn-primary">
          <span class="btn-icon">â¬†ï¸</span>
          ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ
        </button>
      </form>

      <div id="importResult" class="result-message" style="display: none;"></div>
    </div>

    <!-- CSVå½¢å¼èª¬æ˜ -->
    <div class="csv-section csv-format">
      <h2>ğŸ“‹ CSVå½¢å¼</h2>
      <p>CSVãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®å½¢å¼ã§ä½œæˆã—ã¦ãã ã•ã„ï¼ˆUTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼‰:</p>
      <div class="format-table">
        <table>
          <thead>
            <tr>
              <th>åˆ—å</th>
              <th>èª¬æ˜</th>
              <th>å¿…é ˆ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>title</code></td>
              <td>è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«</td>
              <td>âœ…</td>
            </tr>
            <tr>
              <td><code>gameTitle</code></td>
              <td>ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«</td>
              <td>âœ…</td>
            </tr>
            <tr>
              <td><code>content</code></td>
              <td>è¨˜äº‹æœ¬æ–‡ï¼ˆMarkdownå¯¾å¿œï¼‰</td>
              <td>âœ…</td>
            </tr>
            <tr>
              <td><code>description</code></td>
              <td>è¨˜äº‹ã®èª¬æ˜</td>
              <td></td>
            </tr>
            <tr>
              <td><code>genre</code></td>
              <td>ã‚¸ãƒ£ãƒ³ãƒ«</td>
              <td></td>
            </tr>
            <tr>
              <td><code>rating</code></td>
              <td>è©•ä¾¡ï¼ˆ1-5ï¼‰</td>
              <td></td>
            </tr>
            <tr>
              <td><code>imageUrl</code></td>
              <td>ç”»åƒURL</td>
              <td></td>
            </tr>
            <tr>
              <td><code>status</code></td>
              <td>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆdraft/publishedï¼‰</td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
.csv-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.csv-header {
  text-align: center;
  margin-bottom: 3rem;
}

.csv-header h1 {
  font-size: 2.5rem;
  margin-bottom: 1rem;
}

.csv-header p {
  color: var(--text-secondary);
  font-size: 1.1rem;
}

.csv-sections {
  display: grid;
  gap: 2rem;
}

.csv-section {
  background: var(--card-background);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  padding: 2rem;
}

.csv-section h2 {
  font-size: 1.5rem;
  margin-bottom: 1rem;
  color: var(--primary-color);
}

.csv-section p {
  color: var(--text-secondary);
  margin-bottom: 1.5rem;
}

.btn-primary {
  padding: 0.75rem 1.5rem;
  background: var(--gradient-primary);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.btn-icon {
  font-size: 1.2rem;
}

.file-input-wrapper {
  margin-bottom: 1rem;
}

.file-input-wrapper input[type="file"] {
  display: none;
}

.file-label {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: var(--background);
  border: 2px dashed var(--border-color);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1rem;
}

.file-label:hover {
  border-color: var(--primary-color);
  background: var(--card-background);
}

.file-icon {
  font-size: 1.5rem;
}

#importForm {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.result-message {
  margin-top: 1.5rem;
  padding: 1rem;
  border-radius: 8px;
  animation: fadeIn 0.3s ease;
}

.result-message.success {
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid #10b981;
  color: #10b981;
}

.result-message.error {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid #ef4444;
  color: #ef4444;
}

.csv-format {
  background: var(--background);
}

.format-table {
  overflow-x: auto;
}

.format-table table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}

.format-table th,
.format-table td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid var(--border-color);
}

.format-table th {
  background: var(--card-background);
  font-weight: 600;
  color: var(--primary-color);
}

.format-table code {
  background: var(--card-background);
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  font-family: 'Courier New', monospace;
  color: var(--accent-color);
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const exportBtn = document.getElementById('exportBtn');
  const importForm = document.getElementById('importForm');
  const csvFileInput = document.getElementById('csvFile');
  const fileName = document.getElementById('fileName');
  const importResult = document.getElementById('importResult');

  // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚
  csvFileInput.addEventListener('change', function() {
    if (this.files && this.files[0]) {
      fileName.textContent = this.files[0].name;
    } else {
      fileName.textContent = 'CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ';
    }
  });

  // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  exportBtn.addEventListener('click', async function() {
    exportBtn.disabled = true;
    exportBtn.innerHTML = '<span class="btn-icon">â³</span> ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä¸­...';

    try {
      const response = await fetch('/csv/export');
      
      if (!response.ok) {
        throw new Error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
      }

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `articles_export_${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      document.body.removeChild(a);

      alert('âœ… ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ');
    } catch (error) {
      console.error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
      alert('âŒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
    } finally {
      exportBtn.disabled = false;
      exportBtn.innerHTML = '<span class="btn-icon">â¬‡ï¸</span> è¨˜äº‹ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ';
    }
  });

  // ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
  importForm.addEventListener('submit', async function(e) {
    e.preventDefault();

    if (!csvFileInput.files || !csvFileInput.files[0]) {
      alert('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
      return;
    }

    const submitBtn = importForm.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="btn-icon">â³</span> ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...';
    importResult.style.display = 'none';

    try {
      const formData = new FormData();
      formData.append('csvFile', csvFileInput.files[0]);

      const response = await fetch('/csv/import', {
        method: 'POST',
        body: formData
      });

      const data = await response.json();

      if (data.success) {
        importResult.className = 'result-message success';
        importResult.innerHTML = `
          <strong>âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†</strong><br>
          ${data.importCount}ä»¶ã®è¨˜äº‹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ<br>
          ${data.errorCount > 0 ? `ã‚¨ãƒ©ãƒ¼: ${data.errorCount}ä»¶<br>` : ''}
          ${data.errors && data.errors.length > 0 ? `<br><small>${data.errors.join('<br>')}</small>` : ''}
        `;
        importResult.style.display = 'block';

        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        importForm.reset();
        fileName.textContent = 'CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ';
      } else {
        throw new Error(data.error || 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    } catch (error) {
      console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
      importResult.className = 'result-message error';
      importResult.innerHTML = `<strong>âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼</strong><br>${error.message}`;
      importResult.style.display = 'block';
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<span class="btn-icon">â¬†ï¸</span> ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ';
    }
  });
});
</script>
